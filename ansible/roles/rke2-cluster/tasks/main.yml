- include_vars: ../vars/rke2-cluster-vars.yml
  tags: always

- name: "Create {{ namespace_name }} namespace if not exist"
  kubernetes.core.k8s:
    name: "{{ namespace_name }}"
    api_version: v1
    kind: Namespace
    state: present
  delegate_to: localhost
  run_once: true

# cr√©er le robot account avec le secret

- name: "Deploy latest version of nfs-subdir-external-provisioner chart inside {{ namespace_name }} namespace (and create it)"
  kubernetes.core.helm:
    name: nfs-subdir-external-provisioner
    chart_ref: nfs-subdir-external-provisioner/nfs-subdir-external-provisioner
    release_namespace: nfs-subdir-external-provisioner-system
    set_values:
      - value: "nfs.server={{ nfs_server_name }}"
        value_type: string
      - value: "nfs.path={{ nfs_path }}"
        value_type: string
      - value: storageClass.defaultClass=true
        value_type: string
  delegate_to: localhost
  run_once: true

# install mariadb helm
# /kubernetes/wpn-ngnix.yml
# /kubernetes/wpn-mariadb.yml
