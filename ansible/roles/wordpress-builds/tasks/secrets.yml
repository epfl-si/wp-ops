- tags: always
  include_vars: "{{ item }}"
  with_items:
    - build-secrets.yml

- name: wp-base/Secret - Push Secret
  kubernetes.core.k8s:
    definition:
      apiVersion: v1
      kind: Secret
      type: kubernetes.io/dockerconfigjson
      metadata:
        name: tekton-push
        namespace: "{{ inventory_namespace }}"
      data:
        .dockerconfigjson: "{{ _tekton_push_secret_config | to_json | b64encode }}"
  vars:
    _quay_basic_auth: "{{ quay_push_credentials.name }}:{{ quay_push_credentials.password | eyaml(eyaml_keys) }}"
    _tekton_push_secret_config:
      auths:
        "quay-its.epfl.ch":
          "auth": "{{ _quay_basic_auth | b64encode }}"
