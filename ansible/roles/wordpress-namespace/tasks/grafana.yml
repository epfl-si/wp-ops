- name: "Deploy the WordPress Gragana dashboards"
  when: inventory_namespace == 'svc0041p-wordpress'
  vars:
    _foldername: WordPress
  block:
    - name: "GrafanaFolder/WordPress"
      kubernetes.core.k8s:
        state: present
        definition:
          kind: GrafanaFolder
          apiVersion: grafana.integreatly.org/v1beta1
          metadata:
            name: wordpress
            namespace: "{{ inventory_namespace }}"
          spec:
            allowCrossNamespaceImport: true
            instanceSelector:
              matchLabels:
                dashboards: grafana-prod
            title: "{{ _foldername }}"

    - name: "ConfigMap for GrafanaDashboard/WPN"
      kubernetes.core.k8s:
        definition:
          apiVersion: v1
          kind: ConfigMap
          metadata:
            name: grafana-dashboard-wpn
            namespace: "{{ inventory_namespace }}"
          data:
            json: "{{ lookup('template', 'grafana/WPN.json') }}"

    - name: "GrafanaDashboard/WPN"
      kubernetes.core.k8s:
        state: present
        definition:
          kind: GrafanaDashboard
          apiVersion: grafana.integreatly.org/v1beta1
          metadata:
            name: wpn
            namespace: "{{ inventory_namespace }}"
          spec:
            allowCrossNamespaceImport: true
            instanceSelector:
              matchLabels:
                dashboards: grafana-prod
            folder: "{{ _foldername }}"
            configMapRef:
              name: grafana-dashboard-wpn
              key: json
